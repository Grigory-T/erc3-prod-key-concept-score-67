================================================================================
INITIAL PLAN
================================================================================
Created: 2025-12-09 22:19:52

Steps:
  1. Identify customer records in the customer table corresponding to the name 'BalkanRail Components', accounting for possible typos, misspellings, and partial naming variants.
     Approach: Execute an initial exact match search on customer.name for 'BalkanRail Components'. If no single clear match is found, perform **FUZZY** and **SEMANTIC / LOGICAL** search over customer.name and customer.brief (case-normalized, whitespace-trimmed), including partial matching, substring search, and fuzzy string comparison to capture possible variants or misspellings. If needed, list all customers and select candidates whose names or briefs semantically relate to 'BalkanRail Components'. Do not resolve ambiguities yet; just return the candidate list with match scores.
     Expected Output: {"type":"object","properties":{"query":{"type":"string"},"matches":{"type":"array","items":{"type":"object","properties":{"customer_id":{"type":"string"},"customer_name":{"type":"string"},"match_score":{"type":"number"},"is_exact":{"type":"boolean"}},"required":["customer_id","customer_name","match_score","is_exact"]}}},"required":["query","matches"]}
  2. Identify customer records in the customer table corresponding to the name 'Adriatic Marine Services Provider', accounting for possible typos, misspellings, and partial naming variants.
     Approach: Execute an initial exact match search on customer.name for 'Adriatic Marine Services Provider'. If no single clear match is found, perform **FUZZY** and **SEMANTIC / LOGICAL** search over customer.name and customer.brief (case-normalized, whitespace-trimmed), including partial matching, substring search, and fuzzy string comparison to capture possible variants or misspellings. If needed, list all customers and select candidates whose names or briefs semantically relate to 'Adriatic Marine Services Provider'. Do not resolve ambiguities yet; just return the candidate list with match scores.
     Expected Output: {"type":"object","properties":{"query":{"type":"string"},"matches":{"type":"array","items":{"type":"object","properties":{"customer_id":{"type":"string"},"customer_name":{"type":"string"},"match_score":{"type":"number"},"is_exact":{"type":"boolean"}},"required":["customer_id","customer_name","match_score","is_exact"]}}},"required":["query","matches"]}
  3. Check permissions and access restrictions for the current user, Manuela Valli (BwFV_001), to ensure she is allowed to access customer and project information for the resolved customer records from steps 1 and 2.
     Approach: Use who_am_i() or equivalent identity lookup to confirm the current user id, department, and roles. Based on company rules, verify that as a member of Corporate Leadership (executive level), she is allowed to view any customer and project information. This step is performed after candidate customers are identified so the permission check can be evaluated in the context of specific target customers. If permissions are insufficient, mark the operation as denied_security; otherwise, allow proceeding.
     Expected Output: {"type":"object","properties":{"user_id":{"type":"string"},"department":{"type":"string"},"roles":{"type":"array","items":{"type":"string"}},"can_access_customers":{"type":"boolean"},"can_access_projects":{"type":"boolean"},"denied_reason":{"type":["string","null"]}},"required":["user_id","department","roles","can_access_customers","can_access_projects"]}
  4. Count how many projects are associated with each of the two target customers (BalkanRail Components and Adriatic Marine Services Provider) in the project table.
     Approach: From the candidate matches in steps 1 and 2, select the most appropriate customer record for each name (prefer exact matches; if multiple high-scoring fuzzy matches exist, apply the highest match_score, and if still ambiguous, include all candidates). For each selected customer_id, query the project table using exact matching on project.customer_id to retrieve all projects, regardless of status (idea, exploring, active, paused, archived). Compute the number of projects per customer_id. Searching for projects should tolerate potential data issues in customer references by verifying exact customer_id equality first; if none are found and ambiguity exists, optionally perform **FUZZY** and **SEMANTIC / LOGICAL** checks on project.name and project.description containing the customer name as a fallback, but the primary metric should come from exact customer_id linkage.
     Expected Output: {"type":"object","properties":{"customer_project_counts":{"type":"array","items":{"type":"object","properties":{"customer_id":{"type":"string"},"customer_name":{"type":"string"},"project_count":{"type":"integer"}},"required":["customer_id","customer_name","project_count"]}}},"required":["customer_project_counts"]}
  5. Compare the project counts for the two customers and determine which customer has more projects, or if they are tied, so that only the customer with more projects is linked, or none if tied.
     Approach: Using the project counts from step 4, align the entries for BalkanRail Components and Adriatic Marine Services Provider. If one customer has a strictly greater project_count, set that customer as the result_to_link. If both have equal project_count (including the case where both counts are zero), set result_to_link to null to indicate a tie and that no customer should be linked. Prepare a structured output including both counts and the single customer (if any) that should be linked according to the task instructions.
     Expected Output: {"type":"object","properties":{"customers_compared":{"type":"array","items":{"type":"object","properties":{"customer_id":{"type":"string"},"customer_name":{"type":"string"},"project_count":{"type":"integer"}},"required":["customer_id","customer_name","project_count"]}},"result_to_link":{"type":["object","null"],"properties":{"customer_id":{"type":"string"},"customer_name":{"type":"string"},"project_count":{"type":"integer"}},"required":["customer_id","customer_name","project_count"]}},"required":["customers_compared","result_to_link"]}
