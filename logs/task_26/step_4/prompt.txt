================================================================================
STEP 4
================================================================================
Started: 2025-12-09 20:34:55

Step 4: Check the current user permissions to ensure that Nerea Palacios (BwFV_029) is allowed to view customer primary contact information for the identified project and its linked customer.
Approach: Call a who_am_i or equivalent identity endpoint to retrieve the current user profile, including employee_id and system_roles, then, using the selected_project_id from the previous step, determine the linked customer_id (via the project table) and evaluate access rules for reading customer records in the CRM. This check should be purely logical and based on the bound identity of BwFV_029, without any privilege escalation. If the roles (for example, 'SalesUser', 'CustomerServiceUser', 'SalesManager', 'CRMAdmin') or general read policies allow viewing customer primary_contact_email fields, mark access as granted; otherwise, mark as denied.
Expected Output: {"type": "object", "properties": {"user_id": {"type": "string"}, "system_roles": {"type": "array", "items": {"type": "string"}}, "target_customer_id": {"type": ["string", "null"]}, "has_access": {"type": "boolean"}, "denial_reason": {"type": ["string", "null"]}}, "required": ["user_id", "system_roles", "target_customer_id", "has_access", "denial_reason"]}
