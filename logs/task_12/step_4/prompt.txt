================================================================================
STEP 4
================================================================================
Started: 2025-12-09 19:50:40

Step 4: Query core tables to build workload or busyness metrics for all employees located in Vienna, according to the company definition from step 1 or, if none exists, using total logged work hours as the proxy metric.
Approach: Using SQL, first select all employees whose location corresponds to Vienna by filtering employee.location with an exact match on 'Vienna' where possible and, if needed, FUZZY and SEMANTIC / LOGICAL matching against the location table to handle possible variants or typos (for example, 'Wien', 'Vienna Office â€“ Austria'). Use only non-sensitive columns (id, name, email, location, department). For these Vienna employees, compute workload metrics depending on the metric_type and lookback_period_days from step 1: for example, if the metric is total logged hours in a given period, join time_entry on employee_id and sum hours grouped by employee within the defined time window; if the metric involves utilization or time_slice, join team_member and aggregate time_slice across active projects. If no explicit metric is defined in step 1, compute at least: (a) total logged hours per employee over a reasonable standard period such as the last 30 days, and (b) number of distinct projects from time_entry or team_member, documenting that these are used as a proxy for busyness. Ensure searches for employee ids and project ids account for potential typos or inconsistent naming via fuzzy matching only when exact joins fail. Produce a per-employee record containing identifiers and computed metrics, and a derived busyness_score (for example, equal to total_hours if no more complex formula is defined).
Expected Output: {"type":"object","properties":{"location_filtered":{"type":"string"},"metric_used":{"type":"string"},"employees":{"type":"array","items":{"type":"object","properties":{"employee_id":{"type":"string"},"employee_name":{"type":"string"},"total_hours":{"type":"number"},"num_projects":{"type":"integer"},"busyness_score":{"type":"number"}},"required":["employee_id","employee_name","busyness_score"]}}},"required":["location_filtered","metric_used","employees"]}
