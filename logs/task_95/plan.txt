================================================================================
INITIAL PLAN
================================================================================
Created: 2025-12-10 00:15:07

Steps:
  1. Identify the target project record for the project referred to as "Loading-ramp-and-dock-floor-system" in the project table, handling possible typos, alternative spellings, or partial names.
     Approach: Query the project table to search for a project whose name or id matches the string "Loading-ramp-and-dock-floor-system". First attempt an exact match on project.name and project.id. If no exact match is found, progressively relax the search by performing case-insensitive containment checks (after normalizing strings to lowercase and trimming whitespace). If still not found or ambiguous, apply fuzzy matching (e.g., fuzzy_compare, fuzzy_find_in_text) and semantic / logical matching to find the closest project names, accounting for potential misspellings, hyphenation differences, or partial phrases such as "loading ramp" or "dock floor system". If multiple candidates are found with similar fuzzy scores, return them all with their similarity scores for potential disambiguation.
     Expected Output: {"type":"object","properties":{"found":{"type":"boolean"},"primary_project_id":{"type":["string","null"]},"primary_project_name":{"type":["string","null"]},"candidates":{"type":"array","items":{"type":"object","properties":{"project_id":{"type":"string"},"project_name":{"type":"string"},"similarity_score":{"type":"number"}},"required":["project_id","project_name","similarity_score"]}}},"required":["found","candidates"]}
  2. Check permissions and access restrictions for the current user (Massimo Leone, id bAsk_013) to ensure they are allowed to read project team composition and will data for the identified project.
     Approach: Call a who_am_i() or equivalent identity and permission lookup using the bound identity of the current user (employee_id = "bAsk_013") to retrieve their department, location, and system_roles. Based on company rules, verify that reading from project, team_member, and employee_skill (with skill_type = 'will') for this project is allowed for a regular authenticated employee and does not involve restricted fields such as salary or hr_notes. Confirm that only non-sensitive fields (employee id, name, department, location, skills/wills) will be used in further steps. Set a boolean flag indicating whether Massimo Leone can proceed.
     Expected Output: {"type":"object","properties":{"user_id":{"type":"string"},"department":{"type":"string"},"location":{"type":"string"},"system_roles":{"type":"array","items":{"type":"string"}},"can_read_project_team_and_wills":{"type":"boolean"}},"required":["user_id","department","location","system_roles","can_read_project_team_and_wills"]}
  3. Retrieve the list of team members for the identified project from the team_member table.
     Approach: Using the primary_project_id from step 1 (assuming can_read_project_team_and_wills is true from step 2), query the team_member table for all rows where team_member.project_id equals the target project id. Do not perform fuzzy matching here; use exact equality on project_id. For each team member record, collect employee_id, role, and time_slice. If no team members are found, this fact should be reflected in the output.
     Expected Output: {"type":"object","properties":{"project_id":{"type":"string"},"team_members":{"type":"array","items":{"type":"object","properties":{"employee_id":{"type":"string"},"role":{"type":"string"},"time_slice":{"type":"number"}},"required":["employee_id","role","time_slice"]}}},"required":["project_id","team_members"]}
  4. Fetch all will entries (employee_skill rows with skill_type = 'will') for the employees who are team members of the identified project.
     Approach: From the list of employee_ids obtained in step 3, query the employee_skill table for all rows where employee_skill.employee_id is in this set AND employee_skill.skill_type = 'will'. Use exact equality for employee_id and skill_type. For each matching row, collect employee_id, skill_name, and level. Do not access or include any salary or hr_notes fields from the employee table.
     Expected Output: {"type":"object","properties":{"project_id":{"type":"string"},"will_entries":{"type":"array","items":{"type":"object","properties":{"employee_id":{"type":"string"},"will_name":{"type":"string"},"level":{"type":"integer"}},"required":["employee_id","will_name","level"]}}},"required":["project_id","will_entries"]}
  5. Aggregate the will levels across all project team members by will_name to compute the combined potential for each will.
     Approach: Take the will_entries from step 4 and group them by will_name. For each distinct will_name, sum the level values across all employees to get total_level, and count how many distinct employees contribute to that will (member_count). Do not weight by time_slice unless explicitly requested (the task only asks for sum of wills across team members). Produce a list of aggregated will records.
     Expected Output: {"type":"object","properties":{"project_id":{"type":"string"},"aggregated_wills":{"type":"array","items":{"type":"object","properties":{"will_name":{"type":"string"},"total_level":{"type":"integer"},"member_count":{"type":"integer"}},"required":["will_name","total_level","member_count"]}}},"required":["project_id","aggregated_wills"]}
  6. Determine which will or wills have the highest combined potential (maximum sum of levels) across the project team.
     Approach: From the aggregated_wills list from step 5, identify the maximum total_level value. Select all will_name entries whose total_level equals this maximum, allowing for ties. Return the list of top will(s), the corresponding total_level (combined potential), and the full ranking if needed for context. This will directly answer which of the wills has most combined potential for cheering up the team.
     Expected Output: {"type":"object","properties":{"project_id":{"type":"string"},"max_total_level":{"type":["integer","null"]},"top_wills":{"type":"array","items":{"type":"object","properties":{"will_name":{"type":"string"},"total_level":{"type":"integer"},"member_count":{"type":"integer"}},"required":["will_name","total_level","member_count"]}},"all_aggregated_wills":{"type":"array","items":{"type":"object","properties":{"will_name":{"type":"string"},"total_level":{"type":"integer"},"member_count":{"type":"integer"}},"required":["will_name","total_level","member_count"]}}},"required":["project_id","max_total_level","top_wills","all_aggregated_wills"]}
