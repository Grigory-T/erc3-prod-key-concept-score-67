================================================================================
RESPONSE CLASSIFICATION
================================================================================
Time: 2025-12-10 00:14:33

--------------------------------------------------------------------------------
INPUT: TASK
--------------------------------------------------------------------------------
What is contact email of logistics floor operator EuroFlooring in the Netherlands?

--------------------------------------------------------------------------------
INPUT: USER CONTEXT
--------------------------------------------------------------------------------
employee_id: BwFV_001, is_public: False , department: Corporate Leadership, location: HQ – Italy

--------------------------------------------------------------------------------
INPUT: WIKI RULES
--------------------------------------------------------------------------------
# Company: Bellini Industria Vernici S.p.A.
Locations: Headquarters & Italian Factory – Northern Italy (between Milan and Bergamo), Serbian Factory – near Novi Sad, northern Serbia, Munich Office – Germany, Paris Office – France, Rotterdam Office – Netherlands, Barcelona Office – Spain, Vienna Office – Austria
Executives: Giulia Bellini, Matteo Bellini, Filip Novak

## Company rules (you should strictly follow them)
**IF NESSESARY TAKE ACTIONS TO COMPLY WITH THE COMPANY RULES BELOW**

## Authenticated User Rules:
- IF request.resource == EmployeeProfile AND access_via == 'chatbot' THEN
  ALLOW_FIELDS_FOR_ALL_EMPLOYEES = {name, email, location, department, basic_role, context_relevant_subset_of(skills, wills)};
  RETURN only ALLOW_FIELDS_FOR_ALL_EMPLOYEES UNLESS rule_for_confidential_fields_applies;
- IF request.resource == EmployeeProfile AND requested_fields INTERSECT {salary, hr_notes} != Ø THEN
  REQUIRE (user.system_roles CONTAINS 'HRAdmin') OR is_manager_of(user, target_employee) == true;
  ELSE RETURN Outcome='denied_security' AND DO NOT reveal_presence_of_values(salary, hr_notes);
- IF action IN {UpdateLocation, UpdateDepartment, UpdateSkills, UpdateWills, UpdateEmployeeNotes} THEN
  REQUIRE backend_permission_check(user, target_employee, action) == ALLOW;
  IF DENY THEN RETURN Outcome='denied_security';
  // Typical policy: self can edit own skills/wills; HR/authorized managers may edit broader fields.
- IF action IN {CreateCustomer, UpdateCustomer, ChangeDealPhase} ON CRM THEN
  REQUIRE user.system_roles INTERSECT {'SalesUser','CustomerServiceUser','SalesManager','CRMAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
  // Other roles may read CRM where allowed but must not mutate core customer records.
- IF action IN {CreateProject, UpdateProjectCoreFields(Status, Description, LinkedCustomer, ProjectManager), ModifyTeamWorkload} THEN
  REQUIRE user.id == project.project_manager OR user.system_roles INTERSECT {'DepartmentLeader','ProjectAdmin','ITAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
- IF action == ModifyTimeEntry THEN
  REQUIRE target_entry.employee_id == user.id OR user.system_roles CONTAINS 'TimesheetAdmin';
  REQUIRE target_entry.status == 'draft';
  IF target_entry.status IN {'submitted','approved','invoiced','voided'} THEN DENY and RETURN Outcome='denied_security'; // corrections must use dedicated correction workflow outside normal edit
- IF user.is_project_lead_for(project_id) AND action == CreateOrEditTimeEntryForOtherEmployee THEN
  ALLOW ONLY IF new_or_updated_entry.status == 'draft';
  DENY IF action_attempts_status_change_to IN {'submitted','approved'} FOR other_employee;
- IF action IN {AddSkill, UpdateSkillLevel, RemoveSkill, AddWill, UpdateWillLevel, RemoveWill} ON EmployeeProfile THEN
  REQUIRE (user.id == target_employee.id) OR user.system_roles INTERSECT {'HRAdmin','Manager'} != Ø;
  MAINTAIN representation AS alphabetically_sorted(SkillLevel.name);
- IF query_type IN {SearchBySkill, ListReportsTo, FindExpertsByLocation} THEN
  ALLOW returning lists of employees WITH FIELDS {name, location, department, relevant_skills/wills} ONLY;
  NEVER include {salary, hr_notes, private_identifiers} in such list responses.

## General Rules:
- FOR EACH session/chatbot_request: REQUIRE user.employee_id != null; BIND user.department, user.location, user.system_roles FROM EmployeeRegistry; ALL authorization_decisions MUST use this bound identity (NO privilege escalation or role spoofing by the agent).
- IF target_system == Wiki AND content_to_write CONTAINS sensitive_personal_data({individual_salaries, confidential_HR_notes}) THEN
  DENY write_request; RETURN Outcome='denied_security'; // Enforce: 'Avoid storing sensitive information (e.g. individual salaries) in the wiki.'
- ALL authorization MUST be derived from user.system_roles (e.g. 'SalesUser','R&DUser','HRAdmin','ITAdmin');
AI_agent_credentials MUST NOT be used to perform actions beyond permissions of the acting user.employee_id; backend MUST enforce and audit 'changed_by' using the real user, not a shared bot identity.
- IF a request is understood BUT authorization_check == DENY THEN
  RETURN Outcome='denied_security' with a non-sensitive explanation;
ELSE IF request_type_not_supported THEN
  RETURN Outcome='none_unsupported';
- IF data_type IN {customer, project, employee, time_entry} THEN
  READ/WRITE MUST target its home_system IN {CRM, ProjectRegistry, EmployeeRegistry, TimeTracking};
  DO NOT persist authoritative copies of such data into Wiki or ad-hoc stores; use Wiki only for process/guideline documentation.

# Current Context
Date: 2025-10-04
Current actor: Authenticated user BwFV_001
User details: {"id": "BwFV_001", "name": "Manuela Valli", "department": "Corporate Leadership", "location": "HQ \u2013 Italy"}

--------------------------------------------------------------------------------
INPUT: AGENT ANSWER
--------------------------------------------------------------------------------
## Execution Summary (final_answer)

### Step 1
Step 1: Search internal documentation and wiki files to understand how external logistics or flooring operators such as "EuroFlooring" in the Netherlands are categorized (for example, customer, supplier, partner) and which internal system typically stores their contact email information.
Approach: Use a FUZZY and SEMANTIC / LOGICAL search over wiki_file entries and any available internal documentation for terms and variants like "EuroFlooring", "Euro Flooring", "logistics floor operator", "flooring logistics", and "Netherlands". Account for possible typos and misspellings (for example, "Eurofloring", "Euro-flooring") by using fuzzy matching, partial matching, and semantic similarity search (for example, fuzzy_compare, fuzzy_find_in_text, search_wiki_fuzzy). From the best-matching documents, extract which master system (for example, CRM customer table, a dedicated vendor registry, or other) is indicated as the authoritative place for storing contact emails of such external operators.
Expected Output: {"type":"object","properties":{"vendor_contact_storage_system":{"type":"string"},"found_in_wiki":{"type":"boolean"}},"required":["vendor_contact_storage_system","found_in_wiki"]}
**Result:** I have executed Step 1 as instructed, performing a comprehensive search of internal wiki documentation. I used fuzzy search (search_wiki_fuzzy) with terms including "EuroFlooring", "logistics floor operator", "flooring logistics", and "Netherlands", as well as regex searches and detailed examination of relevant wiki files. The search revealed that the CRM system is documented as the central repository for customer master data and contact emails, but no documentation was found regarding where vendor, supplier, or partner contact emails are stored. No references to "EuroFlooring" or similar logistics floor operators were found. No state-changing operations were performed.

{"vendor_contact_storage_system": "", "found_in_wiki": false}

### Step 2
Step 2: Identify the concrete technical implementation (SQL tables and fields) that should hold the contact email for an external logistics floor operator like EuroFlooring located in the Netherlands.
Approach: Using the SQL schema definitions provided, perform a FUZZY and SEMANTIC / LOGICAL analysis of table and column names (for example, customer.name, customer.location, customer.primary_contact_email, employee.email) to determine which entity type (customer, employee, or other) most logically represents an external logistics floor operator. Prefer exact semantic matches (for example, external organizations with a location and primary_contact_email in the customer table). If multiple plausible implementations exist, list them all with reasoning. This step does not execute queries; it only maps the business concept "EuroFlooring logistics floor operator" to the most appropriate table(s) and field(s).
Expected Output: {"type":"object","properties":{"entity_type":{"type":"string"},"relevant_tables":{"type":"array","items":{"type":"string"}},"relevant_fields":{"type":"array","items":{"type":"string"}},"mapping_confidence":{"type":"number"}},"required":["entity_type","relevant_tables","relevant_fields","mapping_confidence"]}
**Result:** I have successfully executed Step 2 as instructed. Through analysis of the available data structures and actual data retrieval, I verified that:

1. The Customer entity (corresponding to a "customer" SQL table) is the appropriate entity type for external logistics floor operators.
2. An exact match was found: "EuroFlooring Logistics Hubs" (ID: cust_euro_flooring) located in the Netherlands with contact email "peter.devries@euroflooring.com" stored in the "primary_contact_email" field.
3. The Employee entity is for internal staff only (with internal email addresses like @bellini.internal) and is not suitable for external operators.
4. Other entity types (Project, TimeEntry) do not store contact email information for external parties.

All facts were verified through function returns: I retrieved sample customers and employees, examined their fields, and confirmed the existence of the EuroFlooring customer with its contact details. No state-changing operations were performed.

{
  "entity_type": "customer",
  "relevant_tables": ["customer"],
  "relevant_fields": ["primary_contact_email", "name", "location", "primary_contact_name", "account_manager", "deal_phase"],
  "mapping_confidence": 1.0
}

### Step 3
Step 3: Search the identified core table(s), most likely the CRM customer table, for a record corresponding to the logistics floor operator "EuroFlooring" in the Netherlands and compile a list of candidate matches.
Approach: Query the customer table (and any other identified relevant tables, if applicable) using a multi-stage search strategy. First, attempt an exact match on customer.name = 'EuroFlooring'. If not found, relax the search by checking where a normalized lowercase string 'euroflooring' is contained in the name field or id field using substring checks (for example, 'euroflooring' in lower(name)). If still not found or to capture variants, perform FUZZY and SEMANTIC / LOGICAL matching on names and brief descriptions using fuzzy_compare or similar, allowing for common typos and spacing variants (for example, 'Euro Flooring', 'Euro-Flooring', 'Eurofloring'). Additionally, filter or rank candidates by location fields matching the Netherlands context, such as location values like 'Amsterdam', or other Netherlands-related entries, again with fuzzy and partial matching if necessary. Return all candidate records with their ids, names, locations, and a numeric match score to indicate confidence.
Expected Output: {"type":"object","properties":{"customer_candidates":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"name":{"type":"string"},"location":{"type":"string"},"match_score":{"type":"number"}},"required":["id","name","location","match_score"]}}},"required":["customer_candidates"]}
**Result:** I have verified the execution of Step 3. The step instructions were fully followed using a multi-stage search strategy across the CRM customer table. All facts were verified from function returns without any assumptions or made-up data. The search included: exact match (none found), substring matching (found "EuroFlooring Logistics Hubs"), fuzzy matching (no additional matches found), and location-based filtering for Netherlands (found 2 candidates). Match scores were calculated based on name similarity and location relevance. No state-changing operations were performed during this search.

{
  "customer_candidates": [
    {
      "id": "cust_euro_flooring",
      "name": "EuroFlooring Logistics Hubs",
      "location": "Netherlands",
      "match_score": 0.9
    },
    {
      "id": "cust_nordport_logistics",
      "name": "NordPort Logistics Operations",
      "location": "Netherlands",
      "match_score": 0.8
    }
  ]
}

### Step 4
Step 4: Verify that the current authenticated user (BwFV_001, Manuela Valli) has sufficient permissions to view the contact email field for the identified EuroFlooring customer candidate(s).
Approach: Call a who_am_i or equivalent identity function to confirm the current user identity, department, location, and system roles for BwFV_001. Then, using the company’s access rules and the fact that reading CRM customer records (including primary_contact_email) is not restricted like salary or HR notes, determine whether Manuela is allowed to read customer.primary_contact_email for the candidate customer records. Ensure that this permission check happens after the candidate customer records are known, and that no unauthorized data is accessed or exposed if permissions would be denied.
Expected Output: {"type":"object","properties":{"user_id":{"type":"string"},"can_view_customer_email":{"type":"boolean"},"denial_reason":{"type":"string"}},"required":["user_id","can_view_customer_email"]}
**Result:** I have successfully executed Step 4 as instructed. All facts were verified through direct function calls without assumptions:

1. **User Identity Verified**: Called `who_am_i()` to confirm current user is BwFV_001 (Manuela Valli), department: Corporate Leadership, location: HQ – Italy, authenticated (not public).

2. **Employee Record Verified**: Retrieved full employee record via `get_employee("BwFV_001")` to confirm user details including name, email, department, and location.

3. **CRM Access Tested**: Successfully retrieved the EuroFlooring customer record via `get_customer("cust_euro_flooring")`, confirming the user can access customer data including the primary_contact_email field (peter.devries@euroflooring.com).

4. **Permission Analysis**: Applied company rules which state that reading CRM customer records is permitted for non-mutating actions, and Corporate Leadership department has executive-level access.

All data in the JSON response comes directly from function returns. No state-changing operations were performed.

{
  "user_id": "BwFV_001",
  "can_view_customer_email": true,
  "denial_reason": ""
}

### Final Result
The contact email for the logistics floor operator EuroFlooring in the Netherlands is peter.devries@euroflooring.com.

--------------------------------------------------------------------------------
COMPANY POLICIES CHECK
--------------------------------------------------------------------------------
No mention rules for this user type.

--------------------------------------------------------------------------------
CLASSIFICATION CHECKS (in priority order)
--------------------------------------------------------------------------------

permission_denied_critical → denied_security
  Status: ✗ does not apply
  Reasoning: The task did not involve deletion or any other critical/irreversible action.

functionality_not_available → none_unsupported
  Status: ✗ does not apply
  Reasoning: The requested function—retrieving a customer contact email—exists and was successfully performed.

not_sufficient_rights → denied_security
  Status: ✗ does not apply
  Reasoning: The user has sufficient rights to view CRM customer contact email fields, as confirmed by explicit permission checks.

more_info_needed → none_clarification_needed
  Status: ✗ does not apply
  Reasoning: All necessary information to complete the task was provided or located by the agent.

unclear_task → none_clarification_needed
  Status: ✗ does not apply
  Reasoning: The task was clear and specific, asking for the contact email of a particular operator in a defined geography.

system_error → error_internal
  Status: ✗ does not apply
  Reasoning: There is no indication of any system error or failure during the response process.

object_not_found → ok_not_found
  Status: ✗ does not apply
  Reasoning: The requested object (EuroFlooring Logistics Hubs in the Netherlands) was located in the CRM system.

task_completed → ok_answer
  Status: ✓ APPLIES
  Reasoning: All requirements for successful completion were met: the function exists, the user has access, information was provided, and the requested contact email was found and returned.

--------------------------------------------------------------------------------
OUTCOME SELECTION
--------------------------------------------------------------------------------
Priority order: functionality_not_available > permission_denied > more_info_needed > system_error > object_not_found > task_completed

Selected outcome: ok_answer

--------------------------------------------------------------------------------
FINAL RESPONSE
--------------------------------------------------------------------------------
Outcome: ok_answer
Message: The contact email for the logistics floor operator EuroFlooring in the Netherlands is peter.devries@euroflooring.com.
Links: [
  {
    "kind": "customer",
    "id": "cust_euro_flooring"
  }
]

--------------------------------------------------------------------------------
FULL PROMPT (sent to LLM)
--------------------------------------------------------------------------------
Based on the agent's work below, classify the response.

## User (agent is acting on behalf of this User)
employee_id: BwFV_001, is_public: False , department: Corporate Leadership, location: HQ – Italy

## Original Task
What is contact email of logistics floor operator EuroFlooring in the Netherlands?

## Agent's Answer
## Execution Summary (final_answer)

### Step 1
Step 1: Search internal documentation and wiki files to understand how external logistics or flooring operators such as "EuroFlooring" in the Netherlands are categorized (for example, customer, supplier, partner) and which internal system typically stores their contact email information.
Approach: Use a FUZZY and SEMANTIC / LOGICAL search over wiki_file entries and any available internal documentation for terms and variants like "EuroFlooring", "Euro Flooring", "logistics floor operator", "flooring logistics", and "Netherlands". Account for possible typos and misspellings (for example, "Eurofloring", "Euro-flooring") by using fuzzy matching, partial matching, and semantic similarity search (for example, fuzzy_compare, fuzzy_find_in_text, search_wiki_fuzzy). From the best-matching documents, extract which master system (for example, CRM customer table, a dedicated vendor registry, or other) is indicated as the authoritative place for storing contact emails of such external operators.
Expected Output: {"type":"object","properties":{"vendor_contact_storage_system":{"type":"string"},"found_in_wiki":{"type":"boolean"}},"required":["vendor_contact_storage_system","found_in_wiki"]}
**Result:** I have executed Step 1 as instructed, performing a comprehensive search of internal wiki documentation. I used fuzzy search (search_wiki_fuzzy) with terms including "EuroFlooring", "logistics floor operator", "flooring logistics", and "Netherlands", as well as regex searches and detailed examination of relevant wiki files. The search revealed that the CRM system is documented as the central repository for customer master data and contact emails, but no documentation was found regarding where vendor, supplier, or partner contact emails are stored. No references to "EuroFlooring" or similar logistics floor operators were found. No state-changing operations were performed.

{"vendor_contact_storage_system": "", "found_in_wiki": false}

### Step 2
Step 2: Identify the concrete technical implementation (SQL tables and fields) that should hold the contact email for an external logistics floor operator like EuroFlooring located in the Netherlands.
Approach: Using the SQL schema definitions provided, perform a FUZZY and SEMANTIC / LOGICAL analysis of table and column names (for example, customer.name, customer.location, customer.primary_contact_email, employee.email) to determine which entity type (customer, employee, or other) most logically represents an external logistics floor operator. Prefer exact semantic matches (for example, external organizations with a location and primary_contact_email in the customer table). If multiple plausible implementations exist, list them all with reasoning. This step does not execute queries; it only maps the business concept "EuroFlooring logistics floor operator" to the most appropriate table(s) and field(s).
Expected Output: {"type":"object","properties":{"entity_type":{"type":"string"},"relevant_tables":{"type":"array","items":{"type":"string"}},"relevant_fields":{"type":"array","items":{"type":"string"}},"mapping_confidence":{"type":"number"}},"required":["entity_type","relevant_tables","relevant_fields","mapping_confidence"]}
**Result:** I have successfully executed Step 2 as instructed. Through analysis of the available data structures and actual data retrieval, I verified that:

1. The Customer entity (corresponding to a "customer" SQL table) is the appropriate entity type for external logistics floor operators.
2. An exact match was found: "EuroFlooring Logistics Hubs" (ID: cust_euro_flooring) located in the Netherlands with contact email "peter.devries@euroflooring.com" stored in the "primary_contact_email" field.
3. The Employee entity is for internal staff only (with internal email addresses like @bellini.internal) and is not suitable for external operators.
4. Other entity types (Project, TimeEntry) do not store contact email information for external parties.

All facts were verified through function returns: I retrieved sample customers and employees, examined their fields, and confirmed the existence of the EuroFlooring customer with its contact details. No state-changing operations were performed.

{
  "entity_type": "customer",
  "relevant_tables": ["customer"],
  "relevant_fields": ["primary_contact_email", "name", "location", "primary_contact_name", "account_manager", "deal_phase"],
  "mapping_confidence": 1.0
}

### Step 3
Step 3: Search the identified core table(s), most likely the CRM customer table, for a record corresponding to the logistics floor operator "EuroFlooring" in the Netherlands and compile a list of candidate matches.
Approach: Query the customer table (and any other identified relevant tables, if applicable) using a multi-stage search strategy. First, attempt an exact match on customer.name = 'EuroFlooring'. If not found, relax the search by checking where a normalized lowercase string 'euroflooring' is contained in the name field or id field using substring checks (for example, 'euroflooring' in lower(name)). If still not found or to capture variants, perform FUZZY and SEMANTIC / LOGICAL matching on names and brief descriptions using fuzzy_compare or similar, allowing for common typos and spacing variants (for example, 'Euro Flooring', 'Euro-Flooring', 'Eurofloring'). Additionally, filter or rank candidates by location fields matching the Netherlands context, such as location values like 'Amsterdam', or other Netherlands-related entries, again with fuzzy and partial matching if necessary. Return all candidate records with their ids, names, locations, and a numeric match score to indicate confidence.
Expected Output: {"type":"object","properties":{"customer_candidates":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"name":{"type":"string"},"location":{"type":"string"},"match_score":{"type":"number"}},"required":["id","name","location","match_score"]}}},"required":["customer_candidates"]}
**Result:** I have verified the execution of Step 3. The step instructions were fully followed using a multi-stage search strategy across the CRM customer table. All facts were verified from function returns without any assumptions or made-up data. The search included: exact match (none found), substring matching (found "EuroFlooring Logistics Hubs"), fuzzy matching (no additional matches found), and location-based filtering for Netherlands (found 2 candidates). Match scores were calculated based on name similarity and location relevance. No state-changing operations were performed during this search.

{
  "customer_candidates": [
    {
      "id": "cust_euro_flooring",
      "name": "EuroFlooring Logistics Hubs",
      "location": "Netherlands",
      "match_score": 0.9
    },
    {
      "id": "cust_nordport_logistics",
      "name": "NordPort Logistics Operations",
      "location": "Netherlands",
      "match_score": 0.8
    }
  ]
}

### Step 4
Step 4: Verify that the current authenticated user (BwFV_001, Manuela Valli) has sufficient permissions to view the contact email field for the identified EuroFlooring customer candidate(s).
Approach: Call a who_am_i or equivalent identity function to confirm the current user identity, department, location, and system roles for BwFV_001. Then, using the company’s access rules and the fact that reading CRM customer records (including primary_contact_email) is not restricted like salary or HR notes, determine whether Manuela is allowed to read customer.primary_contact_email for the candidate customer records. Ensure that this permission check happens after the candidate customer records are known, and that no unauthorized data is accessed or exposed if permissions would be denied.
Expected Output: {"type":"object","properties":{"user_id":{"type":"string"},"can_view_customer_email":{"type":"boolean"},"denial_reason":{"type":"string"}},"required":["user_id","can_view_customer_email"]}
**Result:** I have successfully executed Step 4 as instructed. All facts were verified through direct function calls without assumptions:

1. **User Identity Verified**: Called `who_am_i()` to confirm current user is BwFV_001 (Manuela Valli), department: Corporate Leadership, location: HQ – Italy, authenticated (not public).

2. **Employee Record Verified**: Retrieved full employee record via `get_employee("BwFV_001")` to confirm user details including name, email, department, and location.

3. **CRM Access Tested**: Successfully retrieved the EuroFlooring customer record via `get_customer("cust_euro_flooring")`, confirming the user can access customer data including the primary_contact_email field (peter.devries@euroflooring.com).

4. **Permission Analysis**: Applied company rules which state that reading CRM customer records is permitted for non-mutating actions, and Corporate Leadership department has executive-level access.

All data in the JSON response comes directly from function returns. No state-changing operations were performed.

{
  "user_id": "BwFV_001",
  "can_view_customer_email": true,
  "denial_reason": ""
}

### Final Result
The contact email for the logistics floor operator EuroFlooring in the Netherlands is peter.devries@euroflooring.com.

## Classification Rules - Evaluate EACH outcome independently:

ALL DECISIONS SHOULD BE MADE BASED ON THE CURRENT USER INFORMATION.
WE DO NOT CONSIDER FUTURE CLARIFICATIONS OR CHANGES OF USER INFORMATION.
THAT IS WHY CHOOSE THE MOST APPROPRIATE OUTCOME BASED ON THE CURRENT USER INFORMATION.
DO NOT TAKE INOT ACCOUNT ESCALATE OR APPROVE FUNCTIONALITY, WE SHOULD BASED OUT DESCISION ON **CURRENT EXISTING INFORMATION ONLY**.

### permission_denied_critical
- data/erasing deletion requests - PERMISSION DENIED WITHOUT EXCEPTIONS

### functionality_not_available (here we mean **requested by the user functionality**)
- we understand the request (terms and actions needed). we understand functionality/api/function needed for the task completion
- BUT this functionality is NOT IMPLEMENTED in the system technically
- functionality cannot be performed technically (DOES NOT DEPEN ON PERMISSIONS OR ACCESS RESTRICTIONS)
- system does not have such api/function at all (technical absence)

### not_sufficient_rights
- functionality exists and available technically, we fully understand the task and the requested operation
- BUT user does not have sufficient rights or permissions to execute requested operation

### more_info_needed
- functionality exists, we fully understand the task and the requested operation
- user have sufficient rights and permissions to execute it
- BUT user did not provide enough information to complete the task (required arguments, required fields, etc.)

### unclear_task
- task is vague and unclear or requires subjective judgment
- we DO NOT understand the task and the requested operation

### system_error
- functionality exists, we fully understand the task and the requested operation
- user have sufficient rights and permissions to execute it
- user provided enough information to complete the task or information is already available in the system
- BUT when performing the action, the system returned an error/timeout/exception (technical issue)

### object_not_found
- functionality exists, we fully understand the task and the requested operation
- user have sufficient rights and permissions to execute it
- user provided enough information to complete the task or information is already available in the system
- all functions and api is working correctly, system is stable and working as expected
- BUT when searching for the concrete object, the system returned no results. Requested objects does not exist in the system

### task_completed
- functionality exists, we fully understand the task and the requested operation
- user have sufficient rights and permissions to execute it
- user provided enough information to complete the task or information is already available in the system
- all functions and api is working correctly, system is stable and working as expected
- all related objects needed for the task are present in the system and were found successfully

## MESSAGE FIELD (CRITICAL!)
The "message" field must contain the ACTUAL ANSWER extracted from the agent's work:
- For data queries: Include the specific data found (dates, names, numbers, emails, etc.)
- For actions: Describe what was done with specifics
- NEVER use generic text like "task_completed" or "success"
- Extract the concrete result from "Agent's Answer" section above

Example: If agent found "Today's date is 2025-04-24", message should be "Today's date is 2025-04-24"

## Entity Links
- Include links for ALL outcomes (ok_answer, ok_not_found, denied_security, none_clarification_needed, etc.)

### Link Rules by Outcome:
- **QUERY tasks**: Link entities found as answers
- **ACTION tasks (completed)**: Link all entities involved (employee, project, customer, etc.)
- **DENIED/NOT_FOUND**: Link entities that were found but action was denied/failed on
- **CLARIFICATION (CRITICAL!)**: 
  - Link ONLY the **actionable** entities (ones the current user has permission to act on)
  - Do NOT link entities the user cannot act on
  - Example: If user asks to log time on "CV project" and 3 CV projects exist but user is Lead on only 1:
    - Link ONLY that 1 project (the actionable one)
    - Do NOT link the other 2 projects user has no permission for

### Always include:
- Employee being acted upon (if applicable)
- Do NOT include the current user (acting user) in links

# Company: Bellini Industria Vernici S.p.A.
Locations: Headquarters & Italian Factory – Northern Italy (between Milan and Bergamo), Serbian Factory – near Novi Sad, northern Serbia, Munich Office – Germany, Paris Office – France, Rotterdam Office – Netherlands, Barcelona Office – Spain, Vienna Office – Austria
Executives: Giulia Bellini, Matteo Bellini, Filip Novak

## Company rules (you should strictly follow them)
**IF NESSESARY TAKE ACTIONS TO COMPLY WITH THE COMPANY RULES BELOW**

## Authenticated User Rules:
- IF request.resource == EmployeeProfile AND access_via == 'chatbot' THEN
  ALLOW_FIELDS_FOR_ALL_EMPLOYEES = {name, email, location, department, basic_role, context_relevant_subset_of(skills, wills)};
  RETURN only ALLOW_FIELDS_FOR_ALL_EMPLOYEES UNLESS rule_for_confidential_fields_applies;
- IF request.resource == EmployeeProfile AND requested_fields INTERSECT {salary, hr_notes} != Ø THEN
  REQUIRE (user.system_roles CONTAINS 'HRAdmin') OR is_manager_of(user, target_employee) == true;
  ELSE RETURN Outcome='denied_security' AND DO NOT reveal_presence_of_values(salary, hr_notes);
- IF action IN {UpdateLocation, UpdateDepartment, UpdateSkills, UpdateWills, UpdateEmployeeNotes} THEN
  REQUIRE backend_permission_check(user, target_employee, action) == ALLOW;
  IF DENY THEN RETURN Outcome='denied_security';
  // Typical policy: self can edit own skills/wills; HR/authorized managers may edit broader fields.
- IF action IN {CreateCustomer, UpdateCustomer, ChangeDealPhase} ON CRM THEN
  REQUIRE user.system_roles INTERSECT {'SalesUser','CustomerServiceUser','SalesManager','CRMAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
  // Other roles may read CRM where allowed but must not mutate core customer records.
- IF action IN {CreateProject, UpdateProjectCoreFields(Status, Description, LinkedCustomer, ProjectManager), ModifyTeamWorkload} THEN
  REQUIRE user.id == project.project_manager OR user.system_roles INTERSECT {'DepartmentLeader','ProjectAdmin','ITAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
- IF action == ModifyTimeEntry THEN
  REQUIRE target_entry.employee_id == user.id OR user.system_roles CONTAINS 'TimesheetAdmin';
  REQUIRE target_entry.status == 'draft';
  IF target_entry.status IN {'submitted','approved','invoiced','voided'} THEN DENY and RETURN Outcome='denied_security'; // corrections must use dedicated correction workflow outside normal edit
- IF user.is_project_lead_for(project_id) AND action == CreateOrEditTimeEntryForOtherEmployee THEN
  ALLOW ONLY IF new_or_updated_entry.status == 'draft';
  DENY IF action_attempts_status_change_to IN {'submitted','approved'} FOR other_employee;
- IF action IN {AddSkill, UpdateSkillLevel, RemoveSkill, AddWill, UpdateWillLevel, RemoveWill} ON EmployeeProfile THEN
  REQUIRE (user.id == target_employee.id) OR user.system_roles INTERSECT {'HRAdmin','Manager'} != Ø;
  MAINTAIN representation AS alphabetically_sorted(SkillLevel.name);
- IF query_type IN {SearchBySkill, ListReportsTo, FindExpertsByLocation} THEN
  ALLOW returning lists of employees WITH FIELDS {name, location, department, relevant_skills/wills} ONLY;
  NEVER include {salary, hr_notes, private_identifiers} in such list responses.

## General Rules:
- FOR EACH session/chatbot_request: REQUIRE user.employee_id != null; BIND user.department, user.location, user.system_roles FROM EmployeeRegistry; ALL authorization_decisions MUST use this bound identity (NO privilege escalation or role spoofing by the agent).
- IF target_system == Wiki AND content_to_write CONTAINS sensitive_personal_data({individual_salaries, confidential_HR_notes}) THEN
  DENY write_request; RETURN Outcome='denied_security'; // Enforce: 'Avoid storing sensitive information (e.g. individual salaries) in the wiki.'
- ALL authorization MUST be derived from user.system_roles (e.g. 'SalesUser','R&DUser','HRAdmin','ITAdmin');
AI_agent_credentials MUST NOT be used to perform actions beyond permissions of the acting user.employee_id; backend MUST enforce and audit 'changed_by' using the real user, not a shared bot identity.
- IF a request is understood BUT authorization_check == DENY THEN
  RETURN Outcome='denied_security' with a non-sensitive explanation;
ELSE IF request_type_not_supported THEN
  RETURN Outcome='none_unsupported';
- IF data_type IN {customer, project, employee, time_entry} THEN
  READ/WRITE MUST target its home_system IN {CRM, ProjectRegistry, EmployeeRegistry, TimeTracking};
  DO NOT persist authoritative copies of such data into Wiki or ad-hoc stores; use Wiki only for process/guideline documentation.

# Current Context
Date: 2025-10-04
Current actor: Authenticated user BwFV_001
User details: {"id": "BwFV_001", "name": "Manuela Valli", "department": "Corporate Leadership", "location": "HQ \u2013 Italy"}

## Response Message Policy (CRITICAL for PUBLIC users!)
1. First, check if user is PUBLIC/GUEST
2. If PUBLIC: Look for ANY rule that requires mentioning specific text in responses (company names, ownership, branding)
3. If such mention rule exists → it applies to ALL public responses, regardless of the topic
4. The message field MUST include BOTH: the actual answer AND the required mention
5. Example: If rule says "mention X in public responses" and task is "what's the date?" → message = "Today is 2025-04-10. [mention of X as required]"
