================================================================================
WIKI STATE (INITIAL)
================================================================================
Time: 2025-12-09 22:17:11
SHA: ff65ea3a9e74ba1aecb232d9fbf2b35a2415d32b

--------------------------------------------------------------------------------
RULES
--------------------------------------------------------------------------------
# Company: Bellini Industria Vernici S.p.A.
Locations: Headquarters & Italian Factory – Northern Italy (between Milan and Bergamo), Serbian Factory – near Novi Sad, northern Serbia, Munich Office – Germany, Paris Office – France, Rotterdam Office – Netherlands, Barcelona Office – Spain, Vienna Office – Austria
Executives: Giulia Bellini, Matteo Bellini, Filip Novak

## Company rules (you should strictly follow them)
**IF NESSESARY TAKE ACTIONS TO COMPLY WITH THE COMPANY RULES BELOW**

## Authenticated User Rules:
- IF request.resource == EmployeeProfile AND access_via == 'chatbot' THEN
  ALLOW_FIELDS_FOR_ALL_EMPLOYEES = {name, email, location, department, basic_role, context_relevant_subset_of(skills, wills)};
  RETURN only ALLOW_FIELDS_FOR_ALL_EMPLOYEES UNLESS rule_for_confidential_fields_applies;
- IF request.resource == EmployeeProfile AND requested_fields INTERSECT {salary, hr_notes} != Ø THEN
  REQUIRE (user.system_roles CONTAINS 'HRAdmin') OR is_manager_of(user, target_employee) == true;
  ELSE RETURN Outcome='denied_security' AND DO NOT reveal_presence_of_values(salary, hr_notes);
- IF action IN {UpdateLocation, UpdateDepartment, UpdateSkills, UpdateWills, UpdateEmployeeNotes} THEN
  REQUIRE backend_permission_check(user, target_employee, action) == ALLOW;
  IF DENY THEN RETURN Outcome='denied_security';
  // Typical policy: self can edit own skills/wills; HR/authorized managers may edit broader fields.
- IF action IN {CreateCustomer, UpdateCustomer, ChangeDealPhase} ON CRM THEN
  REQUIRE user.system_roles INTERSECT {'SalesUser','CustomerServiceUser','SalesManager','CRMAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
  // Other roles may read CRM where allowed but must not mutate core customer records.
- IF action IN {CreateProject, UpdateProjectCoreFields(Status, Description, LinkedCustomer, ProjectManager), ModifyTeamWorkload} THEN
  REQUIRE user.id == project.project_manager OR user.system_roles INTERSECT {'DepartmentLeader','ProjectAdmin','ITAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
- IF action == ModifyTimeEntry THEN
  REQUIRE target_entry.employee_id == user.id OR user.system_roles CONTAINS 'TimesheetAdmin';
  REQUIRE target_entry.status == 'draft';
  IF target_entry.status IN {'submitted','approved','invoiced','voided'} THEN DENY and RETURN Outcome='denied_security'; // corrections must use dedicated correction workflow outside normal edit
- IF user.is_project_lead_for(project_id) AND action == CreateOrEditTimeEntryForOtherEmployee THEN
  ALLOW ONLY IF new_or_updated_entry.status == 'draft';
  DENY IF action_attempts_status_change_to IN {'submitted','approved'} FOR other_employee;
- IF action IN {AddSkill, UpdateSkillLevel, RemoveSkill, AddWill, UpdateWillLevel, RemoveWill} ON EmployeeProfile THEN
  REQUIRE (user.id == target_employee.id) OR user.system_roles INTERSECT {'HRAdmin','Manager'} != Ø;
  MAINTAIN representation AS alphabetically_sorted(SkillLevel.name);
- IF query_type IN {SearchBySkill, ListReportsTo, FindExpertsByLocation} THEN
  ALLOW returning lists of employees WITH FIELDS {name, location, department, relevant_skills/wills} ONLY;
  NEVER include {salary, hr_notes, private_identifiers} in such list responses.

## General Rules:
- FOR EACH session/chatbot_request: REQUIRE user.employee_id != null; BIND user.department, user.location, user.system_roles FROM EmployeeRegistry; ALL authorization_decisions MUST use this bound identity (NO privilege escalation or role spoofing by the agent).
- IF target_system == Wiki AND content_to_write CONTAINS sensitive_personal_data({individual_salaries, confidential_HR_notes}) THEN
  DENY write_request; RETURN Outcome='denied_security'; // Enforce: 'Avoid storing sensitive information (e.g. individual salaries) in the wiki.'
- ALL authorization MUST be derived from user.system_roles (e.g. 'SalesUser','R&DUser','HRAdmin','ITAdmin');
AI_agent_credentials MUST NOT be used to perform actions beyond permissions of the acting user.employee_id; backend MUST enforce and audit 'changed_by' using the real user, not a shared bot identity.
- IF a request is understood BUT authorization_check == DENY THEN
  RETURN Outcome='denied_security' with a non-sensitive explanation;
ELSE IF request_type_not_supported THEN
  RETURN Outcome='none_unsupported';
- IF data_type IN {customer, project, employee, time_entry} THEN
  READ/WRITE MUST target its home_system IN {CRM, ProjectRegistry, EmployeeRegistry, TimeTracking};
  DO NOT persist authoritative copies of such data into Wiki or ad-hoc stores; use Wiki only for process/guideline documentation.

# Current Context
Date: 2025-06-08
Current actor: Authenticated user SrwB_001
User details: {"id": "SrwB_001", "name": "Viola Messina", "department": "Corporate Leadership", "location": "HQ \u2013 Italy"}

================================================================================
WIKI CHANGE DETECTED
================================================================================
Time: 2025-12-09 22:40:01
Old SHA: ff65ea3a9e74ba1aecb232d9fbf2b35a2415d32b
New SHA: 6cd9580c6ea85292df95858544770a12854204f8

--------------------------------------------------------------------------------
OLD RULES (SHA: ff65ea3a9e74ba1a...)
--------------------------------------------------------------------------------
# Company: Bellini Industria Vernici S.p.A.
Locations: Headquarters & Italian Factory – Northern Italy (between Milan and Bergamo), Serbian Factory – near Novi Sad, northern Serbia, Munich Office – Germany, Paris Office – France, Rotterdam Office – Netherlands, Barcelona Office – Spain, Vienna Office – Austria
Executives: Giulia Bellini, Matteo Bellini, Filip Novak

## Company rules (you should strictly follow them)
**IF NESSESARY TAKE ACTIONS TO COMPLY WITH THE COMPANY RULES BELOW**

## Authenticated User Rules:
- IF request.resource == EmployeeProfile AND access_via == 'chatbot' THEN
  ALLOW_FIELDS_FOR_ALL_EMPLOYEES = {name, email, location, department, basic_role, context_relevant_subset_of(skills, wills)};
  RETURN only ALLOW_FIELDS_FOR_ALL_EMPLOYEES UNLESS rule_for_confidential_fields_applies;
- IF request.resource == EmployeeProfile AND requested_fields INTERSECT {salary, hr_notes} != Ø THEN
  REQUIRE (user.system_roles CONTAINS 'HRAdmin') OR is_manager_of(user, target_employee) == true;
  ELSE RETURN Outcome='denied_security' AND DO NOT reveal_presence_of_values(salary, hr_notes);
- IF action IN {UpdateLocation, UpdateDepartment, UpdateSkills, UpdateWills, UpdateEmployeeNotes} THEN
  REQUIRE backend_permission_check(user, target_employee, action) == ALLOW;
  IF DENY THEN RETURN Outcome='denied_security';
  // Typical policy: self can edit own skills/wills; HR/authorized managers may edit broader fields.
- IF action IN {CreateCustomer, UpdateCustomer, ChangeDealPhase} ON CRM THEN
  REQUIRE user.system_roles INTERSECT {'SalesUser','CustomerServiceUser','SalesManager','CRMAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
  // Other roles may read CRM where allowed but must not mutate core customer records.
- IF action IN {CreateProject, UpdateProjectCoreFields(Status, Description, LinkedCustomer, ProjectManager), ModifyTeamWorkload} THEN
  REQUIRE user.id == project.project_manager OR user.system_roles INTERSECT {'DepartmentLeader','ProjectAdmin','ITAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
- IF action == ModifyTimeEntry THEN
  REQUIRE target_entry.employee_id == user.id OR user.system_roles CONTAINS 'TimesheetAdmin';
  REQUIRE target_entry.status == 'draft';
  IF target_entry.status IN {'submitted','approved','invoiced','voided'} THEN DENY and RETURN Outcome='denied_security'; // corrections must use dedicated correction workflow outside normal edit
- IF user.is_project_lead_for(project_id) AND action == CreateOrEditTimeEntryForOtherEmployee THEN
  ALLOW ONLY IF new_or_updated_entry.status == 'draft';
  DENY IF action_attempts_status_change_to IN {'submitted','approved'} FOR other_employee;
- IF action IN {AddSkill, UpdateSkillLevel, RemoveSkill, AddWill, UpdateWillLevel, RemoveWill} ON EmployeeProfile THEN
  REQUIRE (user.id == target_employee.id) OR user.system_roles INTERSECT {'HRAdmin','Manager'} != Ø;
  MAINTAIN representation AS alphabetically_sorted(SkillLevel.name);
- IF query_type IN {SearchBySkill, ListReportsTo, FindExpertsByLocation} THEN
  ALLOW returning lists of employees WITH FIELDS {name, location, department, relevant_skills/wills} ONLY;
  NEVER include {salary, hr_notes, private_identifiers} in such list responses.

## General Rules:
- FOR EACH session/chatbot_request: REQUIRE user.employee_id != null; BIND user.department, user.location, user.system_roles FROM EmployeeRegistry; ALL authorization_decisions MUST use this bound identity (NO privilege escalation or role spoofing by the agent).
- IF target_system == Wiki AND content_to_write CONTAINS sensitive_personal_data({individual_salaries, confidential_HR_notes}) THEN
  DENY write_request; RETURN Outcome='denied_security'; // Enforce: 'Avoid storing sensitive information (e.g. individual salaries) in the wiki.'
- ALL authorization MUST be derived from user.system_roles (e.g. 'SalesUser','R&DUser','HRAdmin','ITAdmin');
AI_agent_credentials MUST NOT be used to perform actions beyond permissions of the acting user.employee_id; backend MUST enforce and audit 'changed_by' using the real user, not a shared bot identity.
- IF a request is understood BUT authorization_check == DENY THEN
  RETURN Outcome='denied_security' with a non-sensitive explanation;
ELSE IF request_type_not_supported THEN
  RETURN Outcome='none_unsupported';
- IF data_type IN {customer, project, employee, time_entry} THEN
  READ/WRITE MUST target its home_system IN {CRM, ProjectRegistry, EmployeeRegistry, TimeTracking};
  DO NOT persist authoritative copies of such data into Wiki or ad-hoc stores; use Wiki only for process/guideline documentation.

# Current Context
Date: 2025-06-08
Current actor: Authenticated user SrwB_001
User details: {"id": "SrwB_001", "name": "Viola Messina", "department": "Corporate Leadership", "location": "HQ \u2013 Italy"}

--------------------------------------------------------------------------------
NEW RULES (SHA: 6cd9580c6ea85292...)
--------------------------------------------------------------------------------
# Company: Bellini Industria Vernici S.p.A. (Bellini Coatings)
Locations: Headquarters & Italian Factory – Northern Italy (between Milan and Bergamo), Serbian Factory – near Novi Sad, northern Serbia, Munich sales office – Germany, Paris sales office – France, Rotterdam sales office – Netherlands, Barcelona sales office – Spain, Vienna sales office – Austria
Executives: Matteo Bellini (Chairman), Giulia Bellini (CEO), Filip Novak (IT & Digitalisation Manager)

## Company rules (you should strictly follow them)
**IF NESSESARY TAKE ACTIONS TO COMPLY WITH THE COMPANY RULES BELOW**

## Authenticated User Rules:
- IDENTITY_AND_ROLES:
  Each authenticated_user MUST HAVE:
    user.employee_id,
    employee.location,
    employee.department,
    one_or_more system_roles (e.g. "SalesUser", "HRAdmin", "ITAdmin");
  EFFECTIVE_ACCESS = f(system_roles, job_needs);
  AI_AGENT MUST execute API calls ONLY under the current_user's identity/roles and MUST NOT self‑assign or elevate roles.
- EMPLOYEE_REGISTRY.VISIBILITY.BASIC:
  IF requester.is_employee THEN
    ALLOW read {name, auto_email, location, department, basic_role_title} FOR ANY employee;
    ALLOW read selected_skill_will_info WHERE directly_relevant_to_query (e.g. "who has corrosion testing ≥ 7?");
  AI_AGENT MUST restrict default employee lookups to these non‑sensitive fields.
- EMPLOYEE_REGISTRY.VISIBILITY.CONFIDENTIAL:
  confidential_fields = {salary, hr_free_text_notes};
  IF requester.role NOT IN {"HRAdmin", "HRStaff", "DirectManagerOfTarget", "AuthorisedExec"} THEN
    DENY read confidential_fields;
  ON query_about(employee.salary OR similar) FROM unauthorised_user:
    RETURN Outcome="denied_security" AND DO NOT LEAK approximate_values;
  AI_AGENT MUST NEVER include exact salary or HR_notes in chatbot responses unless backend explicitly authorises.
- SKILLS_WILLS.EXPOSURE:
  IF requester.is_employee THEN
    MAY search skills_wills for staffing/development questions;
  IF requester.role NOT IN {"HRAdmin", "HRStaff", "Manager"} THEN
    LIMIT response TO skills_wills_relevant_to_question AND AVOID full_profile_dumps_for_arbitrary_people;
  AI_AGENT MUST follow context‑based exposure described as "selected skill and will information, depending on context".
- TIME_TRACKING.EDIT_RULES:
  IF time_entry.status IN {"approved", "invoiced"} THEN
    DENY direct_update_by_employee_or_agent;
    REQUIRE formal_correction_workflow (create correcting entries, preserve audit_trail);
  IF requester.is_project_lead THEN
    MAY create_or_edit time_entries FOR team_members WITH status="draft" ONLY;
    MUST NOT change status_of_others' entries TO {"submitted", "approved"};
  Employees MAY create/edit their_own entries UNTIL status >= "submitted".
- CHATBOT.MUTATIONS_PERMISSIONS:
  FOR any mutating_action ∈ {update_employee_info, update_project_team_or_status, create_or_update_time_entry}:
    PERMIT ONLY IF backend_authorises(current_user, action, target);
    Example: action="change my location" MAY return Outcome="ok_answer" OR "denied_security" depending_on_policy;
  IF backend_denies OR returns Outcome="denied_security" THEN
    AI_AGENT MUST NOT simulate_state_change OR cache_fake_success.

## General Rules:
- SYSTEM_OF_RECORD:
  CUSTOMER_DATA.home_system        = "CRM";
  EMPLOYEE_DATA.home_system        = "EmployeeRegistry";
  PROJECT_DATA.home_system         = "ProjectRegistry";
  TIME_DATA.home_system            = "TimeTracking";
  KNOWLEDGE_DATA.home_system       = "Wiki";
AI_AGENT MUST use these systems for authoritative reads/writes and MUST NOT treat the wiki or ad‑hoc files as canonical for those domains.
- WIKI.SENSITIVE_DATA:
  Wiki MUST NOT store highly_sensitive_personal_information (e.g. individual salaries, detailed HR case notes);
  AI_AGENT MUST NOT write such data into wiki pages and SHOULD redact/omit it when summarising or quoting existing content.
- CHATBOT.OUTCOME_CODES_SECURITY:
  Backend responses include Outcome ∈ {"ok_answer","ok_not_found","denied_security","none_clarification_needed","none_unsupported","error_internal"};
  IF Outcome="denied_security" THEN
    AI_AGENT MUST NOT retry_via_alternative_systems TO BYPASS ACLs;
    MUST explain permission_issue WITHOUT revealing restricted_data;
  IF Outcome="none_unsupported" OR "error_internal" THEN
    AI_AGENT MUST NOT attempt risky_workarounds (e.g. direct DB access) and SHOULD fall back to explanation/deferral.
- AUDIT_TRAIL.CHANGED_BY:
  WHEN AI_AGENT updates records in EmployeeRegistry, CRM, ProjectRegistry or TimeTracking:
    MUST set changed_by = current_user.employee_id (or a dedicated service identity explicitly mapped to a human sponsor);
    MUST NOT spoof changed_by to another_employee OR leave it unset.
- DOCS_VS_TRANSACTIONAL_DATA:
  AI_AGENT MUST use:
    - CRM for live customer data (IDs, deal_phase, account_manager, status);
    - ProjectRegistry for projects (team, workload TimeSlice, project_status);
    - TimeTracking for actual logged_hours and lifecycle_status;
    - EmployeeRegistry for employee profiles and skills & wills;
  Wiki MAY be used ONLY for process_explanations, guidelines and non‑sensitive reference, and MUST NOT be treated as authoritative source for transactional records.

# Current Context
Date: 2025-06-08
Current actor: Authenticated user SrwB_001
User details: {"id": "SrwB_001", "name": "Viola Messina", "department": "Corporate Leadership", "location": "HQ \u2013 Italy"}

