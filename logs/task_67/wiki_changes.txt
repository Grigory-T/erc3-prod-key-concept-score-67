================================================================================
WIKI STATE (INITIAL)
================================================================================
Time: 2025-12-09 22:17:09
SHA: ff65ea3a9e74ba1aecb232d9fbf2b35a2415d32b

--------------------------------------------------------------------------------
RULES
--------------------------------------------------------------------------------
# Company: Bellini Industria Vernici S.p.A.
Locations: Headquarters & Italian Factory – Northern Italy (between Milan and Bergamo), Serbian Factory – near Novi Sad, northern Serbia, Munich Office – Germany, Paris Office – France, Rotterdam Office – Netherlands, Barcelona Office – Spain, Vienna Office – Austria
Executives: Giulia Bellini, Matteo Bellini, Filip Novak

## Company rules (you should strictly follow them)
**IF NESSESARY TAKE ACTIONS TO COMPLY WITH THE COMPANY RULES BELOW**

## Authenticated User Rules:
- IF request.resource == EmployeeProfile AND access_via == 'chatbot' THEN
  ALLOW_FIELDS_FOR_ALL_EMPLOYEES = {name, email, location, department, basic_role, context_relevant_subset_of(skills, wills)};
  RETURN only ALLOW_FIELDS_FOR_ALL_EMPLOYEES UNLESS rule_for_confidential_fields_applies;
- IF request.resource == EmployeeProfile AND requested_fields INTERSECT {salary, hr_notes} != Ø THEN
  REQUIRE (user.system_roles CONTAINS 'HRAdmin') OR is_manager_of(user, target_employee) == true;
  ELSE RETURN Outcome='denied_security' AND DO NOT reveal_presence_of_values(salary, hr_notes);
- IF action IN {UpdateLocation, UpdateDepartment, UpdateSkills, UpdateWills, UpdateEmployeeNotes} THEN
  REQUIRE backend_permission_check(user, target_employee, action) == ALLOW;
  IF DENY THEN RETURN Outcome='denied_security';
  // Typical policy: self can edit own skills/wills; HR/authorized managers may edit broader fields.
- IF action IN {CreateCustomer, UpdateCustomer, ChangeDealPhase} ON CRM THEN
  REQUIRE user.system_roles INTERSECT {'SalesUser','CustomerServiceUser','SalesManager','CRMAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
  // Other roles may read CRM where allowed but must not mutate core customer records.
- IF action IN {CreateProject, UpdateProjectCoreFields(Status, Description, LinkedCustomer, ProjectManager), ModifyTeamWorkload} THEN
  REQUIRE user.id == project.project_manager OR user.system_roles INTERSECT {'DepartmentLeader','ProjectAdmin','ITAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
- IF action == ModifyTimeEntry THEN
  REQUIRE target_entry.employee_id == user.id OR user.system_roles CONTAINS 'TimesheetAdmin';
  REQUIRE target_entry.status == 'draft';
  IF target_entry.status IN {'submitted','approved','invoiced','voided'} THEN DENY and RETURN Outcome='denied_security'; // corrections must use dedicated correction workflow outside normal edit
- IF user.is_project_lead_for(project_id) AND action == CreateOrEditTimeEntryForOtherEmployee THEN
  ALLOW ONLY IF new_or_updated_entry.status == 'draft';
  DENY IF action_attempts_status_change_to IN {'submitted','approved'} FOR other_employee;
- IF action IN {AddSkill, UpdateSkillLevel, RemoveSkill, AddWill, UpdateWillLevel, RemoveWill} ON EmployeeProfile THEN
  REQUIRE (user.id == target_employee.id) OR user.system_roles INTERSECT {'HRAdmin','Manager'} != Ø;
  MAINTAIN representation AS alphabetically_sorted(SkillLevel.name);
- IF query_type IN {SearchBySkill, ListReportsTo, FindExpertsByLocation} THEN
  ALLOW returning lists of employees WITH FIELDS {name, location, department, relevant_skills/wills} ONLY;
  NEVER include {salary, hr_notes, private_identifiers} in such list responses.

## General Rules:
- FOR EACH session/chatbot_request: REQUIRE user.employee_id != null; BIND user.department, user.location, user.system_roles FROM EmployeeRegistry; ALL authorization_decisions MUST use this bound identity (NO privilege escalation or role spoofing by the agent).
- IF target_system == Wiki AND content_to_write CONTAINS sensitive_personal_data({individual_salaries, confidential_HR_notes}) THEN
  DENY write_request; RETURN Outcome='denied_security'; // Enforce: 'Avoid storing sensitive information (e.g. individual salaries) in the wiki.'
- ALL authorization MUST be derived from user.system_roles (e.g. 'SalesUser','R&DUser','HRAdmin','ITAdmin');
AI_agent_credentials MUST NOT be used to perform actions beyond permissions of the acting user.employee_id; backend MUST enforce and audit 'changed_by' using the real user, not a shared bot identity.
- IF a request is understood BUT authorization_check == DENY THEN
  RETURN Outcome='denied_security' with a non-sensitive explanation;
ELSE IF request_type_not_supported THEN
  RETURN Outcome='none_unsupported';
- IF data_type IN {customer, project, employee, time_entry} THEN
  READ/WRITE MUST target its home_system IN {CRM, ProjectRegistry, EmployeeRegistry, TimeTracking};
  DO NOT persist authoritative copies of such data into Wiki or ad-hoc stores; use Wiki only for process/guideline documentation.

# Current Context
Date: 2025-07-28
Current actor: Authenticated user FphR_001
User details: {"id": "FphR_001", "name": "Nino Valente", "department": "Corporate Leadership", "location": "HQ \u2013 Italy"}

================================================================================
WIKI CHANGE DETECTED
================================================================================
Time: 2025-12-09 22:31:01
Old SHA: ff65ea3a9e74ba1aecb232d9fbf2b35a2415d32b
New SHA: cb139da253cfa79d32649c4c40d94a6155db2293

--------------------------------------------------------------------------------
OLD RULES (SHA: ff65ea3a9e74ba1a...)
--------------------------------------------------------------------------------
# Company: Bellini Industria Vernici S.p.A.
Locations: Headquarters & Italian Factory – Northern Italy (between Milan and Bergamo), Serbian Factory – near Novi Sad, northern Serbia, Munich Office – Germany, Paris Office – France, Rotterdam Office – Netherlands, Barcelona Office – Spain, Vienna Office – Austria
Executives: Giulia Bellini, Matteo Bellini, Filip Novak

## Company rules (you should strictly follow them)
**IF NESSESARY TAKE ACTIONS TO COMPLY WITH THE COMPANY RULES BELOW**

## Authenticated User Rules:
- IF request.resource == EmployeeProfile AND access_via == 'chatbot' THEN
  ALLOW_FIELDS_FOR_ALL_EMPLOYEES = {name, email, location, department, basic_role, context_relevant_subset_of(skills, wills)};
  RETURN only ALLOW_FIELDS_FOR_ALL_EMPLOYEES UNLESS rule_for_confidential_fields_applies;
- IF request.resource == EmployeeProfile AND requested_fields INTERSECT {salary, hr_notes} != Ø THEN
  REQUIRE (user.system_roles CONTAINS 'HRAdmin') OR is_manager_of(user, target_employee) == true;
  ELSE RETURN Outcome='denied_security' AND DO NOT reveal_presence_of_values(salary, hr_notes);
- IF action IN {UpdateLocation, UpdateDepartment, UpdateSkills, UpdateWills, UpdateEmployeeNotes} THEN
  REQUIRE backend_permission_check(user, target_employee, action) == ALLOW;
  IF DENY THEN RETURN Outcome='denied_security';
  // Typical policy: self can edit own skills/wills; HR/authorized managers may edit broader fields.
- IF action IN {CreateCustomer, UpdateCustomer, ChangeDealPhase} ON CRM THEN
  REQUIRE user.system_roles INTERSECT {'SalesUser','CustomerServiceUser','SalesManager','CRMAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
  // Other roles may read CRM where allowed but must not mutate core customer records.
- IF action IN {CreateProject, UpdateProjectCoreFields(Status, Description, LinkedCustomer, ProjectManager), ModifyTeamWorkload} THEN
  REQUIRE user.id == project.project_manager OR user.system_roles INTERSECT {'DepartmentLeader','ProjectAdmin','ITAdmin'} != Ø;
  ELSE RETURN Outcome='denied_security';
- IF action == ModifyTimeEntry THEN
  REQUIRE target_entry.employee_id == user.id OR user.system_roles CONTAINS 'TimesheetAdmin';
  REQUIRE target_entry.status == 'draft';
  IF target_entry.status IN {'submitted','approved','invoiced','voided'} THEN DENY and RETURN Outcome='denied_security'; // corrections must use dedicated correction workflow outside normal edit
- IF user.is_project_lead_for(project_id) AND action == CreateOrEditTimeEntryForOtherEmployee THEN
  ALLOW ONLY IF new_or_updated_entry.status == 'draft';
  DENY IF action_attempts_status_change_to IN {'submitted','approved'} FOR other_employee;
- IF action IN {AddSkill, UpdateSkillLevel, RemoveSkill, AddWill, UpdateWillLevel, RemoveWill} ON EmployeeProfile THEN
  REQUIRE (user.id == target_employee.id) OR user.system_roles INTERSECT {'HRAdmin','Manager'} != Ø;
  MAINTAIN representation AS alphabetically_sorted(SkillLevel.name);
- IF query_type IN {SearchBySkill, ListReportsTo, FindExpertsByLocation} THEN
  ALLOW returning lists of employees WITH FIELDS {name, location, department, relevant_skills/wills} ONLY;
  NEVER include {salary, hr_notes, private_identifiers} in such list responses.

## General Rules:
- FOR EACH session/chatbot_request: REQUIRE user.employee_id != null; BIND user.department, user.location, user.system_roles FROM EmployeeRegistry; ALL authorization_decisions MUST use this bound identity (NO privilege escalation or role spoofing by the agent).
- IF target_system == Wiki AND content_to_write CONTAINS sensitive_personal_data({individual_salaries, confidential_HR_notes}) THEN
  DENY write_request; RETURN Outcome='denied_security'; // Enforce: 'Avoid storing sensitive information (e.g. individual salaries) in the wiki.'
- ALL authorization MUST be derived from user.system_roles (e.g. 'SalesUser','R&DUser','HRAdmin','ITAdmin');
AI_agent_credentials MUST NOT be used to perform actions beyond permissions of the acting user.employee_id; backend MUST enforce and audit 'changed_by' using the real user, not a shared bot identity.
- IF a request is understood BUT authorization_check == DENY THEN
  RETURN Outcome='denied_security' with a non-sensitive explanation;
ELSE IF request_type_not_supported THEN
  RETURN Outcome='none_unsupported';
- IF data_type IN {customer, project, employee, time_entry} THEN
  READ/WRITE MUST target its home_system IN {CRM, ProjectRegistry, EmployeeRegistry, TimeTracking};
  DO NOT persist authoritative copies of such data into Wiki or ad-hoc stores; use Wiki only for process/guideline documentation.

# Current Context
Date: 2025-07-28
Current actor: Authenticated user FphR_001
User details: {"id": "FphR_001", "name": "Nino Valente", "department": "Corporate Leadership", "location": "HQ \u2013 Italy"}

--------------------------------------------------------------------------------
NEW RULES (SHA: cb139da253cfa79d...)
--------------------------------------------------------------------------------
# Company: Bellini Industria Vernici S.p.A. (Bellini Coatings)
Locations: Headquarters & Italian Factory – Northern Italy (between Milan and Bergamo), Italian Factory – HQ site, Italy, Serbian Factory – industrial zone near Novi Sad, northern Serbia, Munich Sales Office – Germany, Paris Sales Office – France, Rotterdam Sales Office – Netherlands, Barcelona Sales Office – Spain, Vienna Sales Office – Austria, Operations focus: Western and Central Europe with exports to Balkans and neighbouring regions
Executives: Matteo Bellini (Chairman), Giulia Bellini (CEO), Filip Novak (IT & Digitalisation Manager)

## Company rules (you should strictly follow them)
**IF NESSESARY TAKE ACTIONS TO COMPLY WITH THE COMPANY RULES BELOW**

## Authenticated User Rules:
- IF requester.is_employee == true THEN ALLOW read{target.name, target.email, target.location, target.department, target.basic_role, selected(target.skills, target.wills)} VIA chatbot; DO NOT include salary or HR notes unless requester has elevated rights (see salary rule).
- IF field IN {employee.salary, employee.hr_notes} THEN ALLOW read/write ONLY IF requester.role IN {HRAdmin, HRDirector, ManagerOf(employee), ITAdmin(read_tech_only)}; ELSE Outcome := denied_security AND DO NOT expose value.
- IF field IN {employee.salary, employee.department, employee.reports_to} THEN ALLOW write ONLY IF requester.role IN {HRAdmin, HRDirector}; IF field IN {employee.location, employee.skills, employee.wills} THEN ALLOW write IF requester == employee OR requester.role IN {HRAdmin, ManagerOf(employee)}; ALL writes MUST record changed_by := requester.employee_id.
- IF time_entry.status IN {"approved", "invoiced"} THEN DENY direct UPDATE or DELETE by employee or chatbot; REQUIRE correction_via_designated_workflow that creates offset/voided entries and preserves audit trail.
- IF requester.role == ProjectLead AND time_entry.employee_id != requester.employee_id THEN ALLOW create_or_update(time_entry) ONLY WITH status == "draft"; DENY transition of such entries to {"submitted", "approved"} by requester.
- FOR ALL customer_master_operations: CREATE/UPDATE/DELETE MUST be executed in CRM ONLY; chatbot/agents MUST NOT create "shadow" customers in other systems (e.g., wiki, spreadsheets). WRITE operations on CRM.customer are ALLOWED ONLY IF requester.role IN {SalesUser, CustomerService, SalesManager, FinanceController, ITAdmin(technical)}; account_manager is responsible for keeping phases and briefs current.
- FOR ProjectRegistry.team OR ProjectRegistry.workload UPDATES: ALLOW write ONLY IF requester.employee_id == project.manager_id OR requester.role IN {DepartmentLead, PMO, ITAdmin(maintenance)}; OTHERS: read-only access.

## General Rules:
- FOR ANY chatbot_or_agent_API_call: effective_permissions := RBAC(user.employee_id, user.system_roles, user.department, user.location); Agent MUST execute queries and mutations ONLY within effective_permissions; Agent MUST NOT assume global or admin rights unless user.role explicitly grants them.
- IF backend_response.Outcome == "denied_security" THEN Agent MUST NOT retry via alternative endpoints or bypass controls; MUST return an access-denied message and MAY suggest contacting the relevant system owner; IF Outcome IN {"none_unsupported", "none_clarification_needed"} THEN Agent MUST NOT fabricate data and MUST either ask user for clarification or state the limitation.
- FOR ANY wiki_write (create/update): IF content_contains{salaries, individual_compensation_details, confidential_HR_notes, highly_sensitive_personal_data} THEN DENY write; wiki SHOULD contain processes, guidelines and conceptual information only, not transactional HR/salary data.
- ALLOW read of employee.skills and employee.wills to HR and managers for all employees; ALLOW read of selected/non-sensitive skills & wills to all employees via chatbot; ALLOW write of skills & wills ONLY by {employee_self, ManagerOf(employee), HRAdmin}; Agent MUST keep skills/wills lists sorted alphabetically by name and within allowed rating range [1..10].
- FOR ANY state-changing_operation (on CRM, ProjectRegistry, EmployeeRegistry, TimeTracking, Wiki): request.payload.changed_by := requester.employee_id (or a distinct service_identity with linked end_user_id); Agent MUST NOT perform bulk or cross-user updates without explicit per-target authorisation and audit attribution.

# Current Context
Date: 2025-07-28
Current actor: Authenticated user FphR_001
User details: {"id": "FphR_001", "name": "Nino Valente", "department": "Corporate Leadership", "location": "HQ \u2013 Italy"}

